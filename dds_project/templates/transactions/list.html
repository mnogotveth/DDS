{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1 class="h3 mb-3">Движение денежных средств</h1>

<form method="get" class="row g-2 align-items-end mb-4">
  <div class="col-6 col-md-2">
    <label class="form-label">Дата от</label>
    <input type="text" name="date_from" value="{{ params.date_from }}" class="form-control" placeholder="дд.мм.гггг">
  </div>
  <div class="col-6 col-md-2">
    <label class="form-label">Дата до</label>
    <input type="text" name="date_to" value="{{ params.date_to }}" class="form-control" placeholder="дд.мм.гггг">
  </div>
  <div class="col-md-2">
    <label class="form-label">Статус</label>
    <select name="status" class="form-select">
      <option value="">Все</option>
      {% for s in statuses %}
        <option value="{{ s.id }}" {% if params.status|stringformat:'s' == s.id|stringformat:'s' %}selected{% endif %}>{{ s.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">Тип</label>
    <select name="type" class="form-select" id="flt_type">
      <option value="">Все</option>
      {% for t in types %}
        <option value="{{ t.id }}" {% if params.type|stringformat:'s' == t.id|stringformat:'s' %}selected{% endif %}>{{ t.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">Категория</label>
    <select name="category" class="form-select" id="flt_category">
      <option value="">Все</option>
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">Подкатегория</label>
    <select name="subcategory" class="form-select" id="flt_subcategory">
      <option value="">Все</option>
    </select>
  </div>
  <div class="col-md-3 mt-2">
    <label class="form-label">Комментарий</label>
    <input type="text" name="search" value="{{ params.search }}" class="form-control" placeholder="поиск по комментарию">
  </div>
  <div class="col-auto mt-2">
    <button class="btn btn-primary">Фильтровать</button>
    <a href="{% url 'ui:transaction_list' %}" class="btn btn-outline-secondary">Сброс</a>
  </div>
</form>

<div class="table-responsive">
<table class="table table-striped align-middle">
  <thead>
    <tr>
      <th>Дата</th>
      <th>Статус</th>
      <th>Тип</th>
      <th>Категория</th>
      <th>Подкатегория</th>
      <th class="text-end">Сумма</th>
      <th>Комментарий</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for tx in object_list %}
      <tr>
        <td>{{ tx.date|date:"d.m.Y" }}</td>
        <td>{{ tx.status.name }}</td>
        <td>{{ tx.type.name }}</td>
        <td>{{ tx.category.name }}</td>
        <td>{{ tx.subcategory.name }}</td>
        <td class="text-end">{{ tx.amount }}</td>
        <td>{{ tx.comment }}</td>
        <td class="text-nowrap">
          <a class="btn btn-sm btn-outline-primary" href="{% url 'ui:transaction_edit' tx.id %}">Ред.</a>
          <a class="btn btn-sm btn-outline-danger" href="{% url 'ui:transaction_delete' tx.id %}">Удалить</a>
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="8" class="text-center text-muted">Нет данных</td></tr>
    {% endfor %}
  </tbody>
</table>
</div>

<nav>
  <ul class="pagination">
    {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" href="?{% if request.GET %}{{ request.GET.urlencode|cut:'page='|cut:page_obj.number|stringformat:'s' }}&{% endif %}page={{ page_obj.previous_page_number }}">«</a></li>
    {% endif %}
    <li class="page-item disabled"><span class="page-link">стр. {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span></li>
    {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" href="?{% if request.GET %}{{ request.GET.urlencode|cut:'page='|cut:page_obj.number|stringformat:'s' }}&{% endif %}page={{ page_obj.next_page_number }}">»</a></li>
    {% endif %}
  </ul>
</nav>

<script>
  //фильтры категорий/подкатегорий при загрузке страницы
  window.UI_FILTER_DEFAULTS = {
    type: "{{ params.type|default:'' }}",
    category: "{{ params.category|default:'' }}",
    subcategory: "{{ params.subcategory|default:'' }}"
  };
</script>
{% endblock %}
